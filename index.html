<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Dashboard: Brazil IT & CS Admissions 2025.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";

        // Your web app's Firebase configuration - DO NOT CHANGE THESE VALUES
        const firebaseConfig = {
            apiKey: "AIzaSyAV6d-joeaVvfv-LU3my3UCz7JxblQ1yXk",
            authDomain: "it-scholarship-436d1.firebaseapp.com",
            projectId: "it-scholarship-436d1",
            storageBucket: "it-scholarship-436d1.firebasestorage.app",
            messagingSenderId: "612771636826",
            appId: "1:612771636826:web:a3e6a7782edbb26cf71a63",
            measurementId: "G-VRE6HKC0WG"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();
        const analytics = getAnalytics(app);

        // UI Elements (defined globally in the module scope for accessibility)
        const loginModal = document.getElementById('login-modal');
        const openLoginBtn = document.getElementById('open-login-btn');
        const closeLoginBtn = document.getElementById('close-login-btn');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const switchFormLink = document.getElementById('switch-form-link');
        const logoutBtn = document.getElementById('logout-btn');
        const userInfoDisplay = document.getElementById('user-info');
        const protectedContent = document.getElementById('protected-content');
        const unauthenticatedMessage = document.getElementById('unauthenticated-message');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const googleSignupBtn = document.getElementById('google-signup-btn');


        // Handle form switching
        if (switchFormLink) {
            switchFormLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (loginForm.classList.contains('hidden')) {
                    loginForm.classList.remove('hidden');
                    signupForm.classList.add('hidden');
                    switchFormLink.textContent = 'Need an account? Sign Up';
                } else {
                    loginForm.classList.add('hidden');
                    signupForm.classList.remove('hidden');
                    switchFormLink.textContent = 'Already have an account? Login';
                }
            });
        }


        // Open/Close Modal
        if (openLoginBtn) {
            openLoginBtn.addEventListener('click', () => {
                loginModal.classList.remove('hidden');
            });
        }
        if (closeLoginBtn) {
            closeLoginBtn.addEventListener('click', () => {
                loginModal.classList.add('hidden');
            });
        }


        // Email/Password Login
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = loginForm.email.value;
                const password = loginForm.password.value;
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    loginModal.classList.add('hidden');
                } catch (error) {
                    alert(`Login Failed: ${error.message}`);
                    console.error("Login Error:", error);
                }
            });
        }


        // Email/Password Signup
        if (signupForm) {
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = signupForm.email.value;
                const password = signupForm.password.value;
                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                    loginModal.classList.add('hidden');
                } catch (error) {
                    alert(`Signup Failed: ${error.message}`);
                    console.error("Signup Error:", error);
                }
            });
        }


        // Google Sign-in for Login Form
        if (googleLoginBtn) {
            googleLoginBtn.addEventListener('click', async () => {
                try {
                    await signInWithPopup(auth, googleProvider);
                    loginModal.classList.add('hidden');
                } catch (error) {
                    alert(`Google Login Failed: ${error.message}`);
                    console.error("Google Login Error:", error);
                }
            });
        }

        // Google Sign-in for Signup Form (same logic as login, just for consistency in UI)
        if (googleSignupBtn) {
            googleSignupBtn.addEventListener('click', async () => {
                try {
                    await signInWithPopup(auth, googleProvider);
                    loginModal.classList.add('hidden');
                } catch (error) {
                    alert(`Google Sign-up Failed: ${error.message}`);
                    console.error("Google Sign-up Error:", error);
                }
            });
        }


        // Logout
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                } catch (error) {
                    alert(`Logout Failed: ${error.message}`);
                    console.error("Logout Error:", error);
                }
            });
        }

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                if (userInfoDisplay) userInfoDisplay.textContent = `Logged in as: ${user.email || user.displayName}`;
                if (openLoginBtn) openLoginBtn.classList.add('hidden');
                if (logoutBtn) logoutBtn.classList.remove('hidden');
                if (protectedContent) protectedContent.classList.remove('hidden');
                if (unauthenticatedMessage) unauthenticatedMessage.classList.add('hidden');
            } else {
                // User is signed out
                if (userInfoDisplay) userInfoDisplay.textContent = 'Not logged in';
                if (openLoginBtn) openLoginBtn.classList.remove('hidden');
                if (logoutBtn) logoutBtn.classList.add('hidden');
                if (protectedContent) protectedContent.classList.add('hidden'); // Hide protected content
                if (unauthenticatedMessage) unauthenticatedMessage.classList.remove('hidden'); // Show message
            }
        });


        document.addEventListener('DOMContentLoaded', () => {
            const FONT_COLOR = '#334155';
            const GRID_COLOR = '#E2E8F0';
            const PALETTE = {
                primary: '#3B82F6', 
                secondary: '#64748B', 
                accent1: '#94A3B8',
            };

            const opportunitiesData = [
                {
                    name: 'UNICAP',
                    status: 'open',
                    title: 'Vestibular 2025.2',
                    dates: 'Registrations: June 17 - July 7, 2025',
                    summary: 'Offers new bachelor\'s degrees in Computer Science and Artificial Intelligence, plus a technologist course in Database (AI & Data Science).',
                    link: 'https://lp.portal.unicap.br/vest_unicap',
                    courses: 'Computer Science, Artificial Intelligence, Database (AI & Data Science)'
                },
                {
                    name: 'IFPI',
                    status: 'open',
                    title: 'Exame Classificatório 2025.2',
                    dates: 'Registrations: June 16 - July 7, 2025',
                    summary: 'Offers 1,025 vacancies for free technical courses. Registrations were temporarily suspended; monitor the official website for reopening.',
                    link: 'https://www.ifpi.edu.br/',
                    courses: 'Informatics, Systems Analysis and Development (confirm in edital)'
                },
                {
                    name: 'UFRRJ',
                    status: 'special',
                    title: 'Residual Vacancies 2025.2',
                    dates: 'Registrations: June 27 - July 4, 2025',
                    summary: 'Process for re-entry and transfers. The edital indicates no vacancies for Information Systems or Computer Science in this call.',
                    link: 'https://portal.ufrrj.br/reingresso-e-transferencias-2025-2-processo-seletivo- Laras-vagas-residuais-da-graduacao/',
                    courses: 'Information Systems (No Vacancies), Computer Science (No Vacancies)'
                },
                {
                    name: 'Faeterj Petrópolis',
                    status: 'closed',
                    title: 'Vestibular 2025.2',
                    dates: 'Registrations closed on June 8, 2025',
                    summary: 'Offered vacancies for the Technologist in IT and Communication course. The application period has ended.',
                    link: '#',
                    courses: 'Technology in Information and Communication'
                },
                {
                    name: 'UFGD',
                    status: 'closed',
                    title: 'Transfer/Diploma Holder Vacancies',
                    dates: 'Registrations closed on May 16, 2025',
                    summary: 'Selective process to fill idle vacancies. The application period has finished, with results imminent.',
                    link: '#',
                    courses: 'Not specified'
                },
                {
                    name: 'UFAPE',
                    status: 'special',
                    title: 'Extra SISU Edital 2025.2',
                    dates: 'Announced on June 13, 2025',
                    summary: 'A supplemental SISU edital was announced, but specific details on courses and deadlines were not available. Requires constant monitoring of the official site.',
                    link: '#',
                    courses: 'Not specified'
                }
            ];

            const opportunitiesGrid = document.getElementById('opportunities-grid');
            const filterContainer = document.getElementById('filter-container');
            const getTipBtn = document.getElementById('get-tip-btn');

            const renderOpportunities = (filter = 'all') => {
                opportunitiesGrid.innerHTML = '';
                const filteredData = opportunitiesData.filter(item => {
                    if (filter === 'all') return true;
                    return item.status === filter;
                });

                if (filteredData.length === 0) {
                     opportunitiesGrid.innerHTML = `<p class="text-slate-500 text-center md:col-span-2 lg:col-span-3">No opportunities match the selected filter.</p>`;
                     return;
                }
                
                filteredData.forEach(item => {
                    let statusClass = '';
                    let statusText = '';
                    switch (item.status) {
                        case 'open':
                            statusClass = 'border-green-500 bg-green-50 text-green-800';
                            statusText = 'Open';
                            break;
                        case 'closed':
                            statusClass = 'border-red-500 bg-red-50 text-red-800';
                            statusText = 'Closed';
                            break;
                        case 'special':
                            statusClass = 'border-yellow-500 bg-yellow-50 text-yellow-800';
                            statusText = 'Special Case';
                            break;
                    }

                    const card = `
                        <div class="opportunity-card bg-white p-5 rounded-lg shadow-md border-l-4 ${statusClass.split(' ')[0]} flex flex-col justify-between transition-transform transform hover:scale-105" data-status="${item.status}">
                            <div>
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-lg text-slate-800">${item.name}</h4>
                                    <span class="text-xs font-bold px-2 py-1 rounded-full ${statusClass}">${statusText}</span>
                                </div>
                                <h5 class="font-semibold text-slate-600 mb-1">${item.title}</h5>
                                <p class="text-sm text-slate-500 font-medium mb-3">${item.dates}</p>
                                <p class="text-sm text-slate-700">${item.summary}</p>
                                <p class="text-sm text-slate-700 mt-3"><span class="font-semibold">Courses:</span> ${item.courses}</p>
                            </div>
                            <a href="${item.link}" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-slate-800 text-white font-semibold py-2 mt-4 rounded-md hover:bg-slate-900 transition-colors">
                                View Edital
                            </a>
                        </div>
                    `;
                    opportunitiesGrid.innerHTML += card;
                });
            };

            filterContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const filter = e.target.dataset.filter;
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('bg-slate-800', 'text-white');
                        btn.classList.add('bg-white', 'text-slate-700');
                    });
                    e.target.classList.add('bg-slate-800', 'text-white');
                    e.target.classList.remove('bg-white', 'text-slate-700');
                    renderOpportunities(filter);
                }
            });

            renderOpportunities(); // Initial render of opportunities
            
            function generateApplicationTip() {
                const admissionsTips = [
                    "📅 Always check edital dates carefully — they vary by institution.",
                    "📄 Prepare your documents early: ID, ENEM results, transcripts, etc.",
                    "🌐 Many vestibular exams accept ENEM scores — you may not need to take a new test.",
                    "🧾 Read each edital fully before applying. Small details matter!",
                    "🎓 Private universities often open more seats mid-year than public ones.",
                    "🚨 Use an email address you check often — communication happens fast!",
                    "👨‍💻 Some technical courses are free and have shorter duration — consider them.",
                    "🔁 Check if your ENEM score qualifies you for SISU waitlist reuse.",
                    "📍 Prioritize local or online options if travel is a challenge.",
                    "🕐 Don't wait until the last minute to apply — servers crash near deadlines!"
                ];

                const tipDisplayElement = document.getElementById('admissions-tip-display');
                const randomIndex = Math.floor(Math.random() * admissionsTips.length);
                const tip = admissionsTips[randomIndex];
                tipDisplayElement.innerHTML = `<p class="text-slate-700 italic">${tip}</p>`;
            }

            getTipBtn.addEventListener('click', generateApplicationTip); // Add event listener for tip button

            const tooltipTitleCallback = (tooltipItems) => {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                if (Array.isArray(label)) { return label.join(' '); } 
                return label;
            };

            const admissionRoutesCtx = document.getElementById('admissionRoutesChart').getContext('2d');
            new Chart(admissionRoutesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Institutional Vestibular', 'Residual Vacancies / Transfer', 'SISU / Prouni Waitlist'],
                    datasets: [{
                        label: 'Admission Route',
                        data: [60, 25, 15],
                        backgroundColor: [PALETTE.primary, PALETTE.secondary, PALETTE.accent1],
                        borderColor: '#f8fafc',
                        borderWidth: 4,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: FONT_COLOR, font: { family: "'Inter', sans-serif" } } },
                        tooltip: { 
                            callbacks: { title: tooltipTitleCallback },
                            backgroundColor: '#334155',
                            titleFont: { size: 14 },
                            bodyFont: { size: 12 },
                            padding: 10,
                            cornerRadius: 4
                        }
                    }
                }
            });

            const navButtons = document.querySelectorAll('header nav button');
            document.querySelector('header nav').addEventListener('click', e => {
                if (e.target.tagName === 'BUTTON' && e.target.dataset.target) {
                    const targetId = e.target.dataset.target;
                    document.getElementById(targetId).scrollIntoView({ behavior: 'smooth' });
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
